name: PR Validation Workflow

on:
  pull_request:
    types: [opened, reopened]
    branches:
      - content

jobs:
  validate-markdown:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Configure Git
      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      # Step 2: Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 3: Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      # Step 4: Install dependencies
      - name: Install dependencies
        run: |
          pip install pandas openpyxl

      - name: Identify changed markdown files
        id: changed-files
        run: |
          CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }} | grep '^content/.*\.md$' || true)
          echo "::set-output name=files::$CHANGED_FILES"

      - name: Delete files in the content directory
        run: |
          rm -rf content
          mkdir content

      - name: Copy changed files to the content directory
        run: |
          for file in ${{ steps.changed-files.outputs.files }}; do
            cp $file content/
          done

      - name: Print the copied files
        run: |
          ls content

      - name: Print the build files
        run: |
          ls build

      # - name: Run compile_content.py
      #   run: |
      #     python .github/script/compile_content.py --dataset .github/datasets/dataset.xlsx

